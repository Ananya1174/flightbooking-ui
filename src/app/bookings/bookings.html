<div class="bookings-page">

  <section class="hero">
    <div class="hero-overlay"></div>

    <div class="hero-content">
      <h1>My Trips</h1>
      <p>Manage your upcoming and past journeys</p>

      <div class="filter-tabs">
        <button
          [class.active]="activeFilter === 'ALL'"
          (click)="setFilter('ALL')">
          All Trips
        </button>

        <button
          [class.active]="activeFilter === 'ACTIVE'"
          (click)="setFilter('ACTIVE')">
          Upcoming
        </button>

        <button
          [class.active]="activeFilter === 'CANCELLED'"
          (click)="setFilter('CANCELLED')">
          Cancelled
        </button>
      </div>
    </div>
  </section>

  <section class="content">

    <p class="empty" *ngIf="loading">Loading your tripsâ€¦</p>
    <p class="empty error" *ngIf="errorMessage">{{ errorMessage }}</p>

    <p class="empty" *ngIf="!loading && filteredBookings.length === 0">
      No trips found.
    </p>

    <div
      class="trip-card"
      *ngFor="let booking of filteredBookings">

      <div class="meta-top">
        <div>
          <strong>PNR:</strong> {{ booking.pnr }}
        </div>
        <div class="date">
          {{ booking.createdAt | date:'mediumDate' }}
        </div>
      </div>

      <div class="info">
        <span>âœˆ Flight {{ booking.flightId }}</span>
        <span>ðŸ‘¥ {{ booking.numSeats }} Passenger(s)</span>
      </div>

      <div class="card-bottom">

        <div class="price-status">
          <div class="price-label">Total Price</div>
          <div class="price">â‚¹{{ booking.totalPrice }}</div>

          <span
            class="status"
            [class.active]="booking.status === 'ACTIVE'"
            [class.cancelled]="booking.status === 'CANCELLED'">
            {{ booking.status }}
          </span>
        </div>

        <div class="actions">
          <button
            class="link"
            (click)="toggleExpand(booking.pnr)">
            {{ expandedPnr === booking.pnr ? 'Hide Details' : 'View Details' }}
          </button>

          <button
            *ngIf="booking.status === 'ACTIVE'"
            class="danger"
            (click)="openCancelDialog(booking)">
            Cancel
          </button>
        </div>

      </div>

      <div
        class="details"
        *ngIf="expandedPnr === booking.pnr">

        <div
          class="passenger"
          *ngFor="let p of booking.passengers">

          <strong>{{ p.name }}</strong>
          <span>Seat {{ p.seatNumber }}</span>
          <span>{{ p.gender }}, {{ p.age }}</span>
          <span>Meal: {{ p.mealPreference }}</span>

        </div>
      </div>

    </div>
  </section>

  <div class="backdrop" *ngIf="selectedBooking || cancelError">
    <div class="dialog">

      <h3>Cancel Booking</h3>

      <p class="error" *ngIf="cancelError">
        {{ cancelError }}
      </p>

      <p *ngIf="selectedBooking && !cancelError">
        Are you sure you want to cancel this booking?
        <br />
        This action cannot be undone.
      </p>

      <div class="dialog-actions">
        <button
          class="secondary"
          (click)="closeCancelDialog()">
          Keep Booking
        </button>

        <button
          class="danger"
          *ngIf="selectedBooking && !cancelError"
          (click)="confirmCancelBooking()">
          Confirm Cancel
        </button>
      </div>

    </div>
  </div>

</div>