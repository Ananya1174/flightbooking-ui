<div class="account-page">
  <aside class="sidebar">
    <h3 class="sidebar-title">My Account</h3>
    <ul class="menu">
      <li
        [class.active]="activeSection === 'profile'"
        [class.disabled]="forcePasswordChange"
        (click)="switchSection('profile')">
        My Profile
      </li>
      <li
        [class.active]="activeSection === 'password'"
        (click)="switchSection('password')">
        Change Password
      </li>
      <li class="disabled">Logged In Devices</li>
      <li class="disabled">Security</li>
    </ul>
  </aside>
  <section class="content">
    <div class="error" *ngIf="forcePasswordChange">
      ⚠️ Your password has expired. You must change it to continue using the application.
    </div>
    <div *ngIf="activeSection === 'profile'" class="card">
      <h2>My Profile</h2>
      <div class="info-row">
        <span>Email</span>
        <strong>{{ email || '—' }}</strong>
      </div>
      <div class="info-row">
        <span>Role</span>
        <strong>USER</strong>
      </div>
    </div>
    <div *ngIf="activeSection === 'password'" class="card">
      <h2>Change Password</h2>

      <div class="success" *ngIf="successMessage">
        {{ successMessage }}
      </div>

      <div class="error" *ngIf="errorMessage">
        {{ errorMessage }}
      </div>

      <form [formGroup]="passwordForm" (ngSubmit)="changePassword()">

        <label>Current Password</label>
        <input type="password" formControlName="oldPassword" />

        <label>New Password</label>
        <input
          type="password"
          formControlName="newPassword"
          (input)="onNewPasswordInput()" />
        <div class="password-hints" *ngIf="passwordStatus">
          <p [class.ok]="passwordStatus.length">✔ Minimum 12 characters</p>
          <p [class.ok]="passwordStatus.uppercase">✔ One uppercase letter</p>
          <p [class.ok]="passwordStatus.lowercase">✔ One lowercase letter</p>
          <p [class.ok]="passwordStatus.number">✔ One number</p>
          <p [class.ok]="passwordStatus.special">✔ One special character</p>

          <p *ngIf="sameAsOld" class="error">
             New password must be different from current password
          </p>
        </div>

        <label>Confirm New Password</label>
        <input type="password" formControlName="confirmPassword" />

        <div
          class="error"
          *ngIf="
            passwordForm.errors?.['passwordMismatch'] &&
            passwordForm.get('confirmPassword')?.touched
          ">
          New password and confirm password do not match
        </div>

        <button
          type="submit"
          [disabled]="
            loading ||
            passwordForm.invalid ||
            !passwordStatus?.valid ||
            sameAsOld
          ">
          {{ loading ? 'Updating...' : 'Update Password' }}
        </button>

      </form>
    </div>

  </section>
</div>